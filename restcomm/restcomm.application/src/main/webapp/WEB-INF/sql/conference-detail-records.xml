<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @author maria-farooq@live.com (Maria Farooq) -->
<mapper
	namespace="org.mobicents.servlet.sip.restcomm.dao.ConferenceDetailRecordsDao">

    <insert id="addConferenceDetailRecord" parameterType="map">
        INSERT INTO "restcomm_conference_detail_records" ("conference_sid", "date_created", "date_updated", "account_sid", "status",
        "start_time", "end_time", "friendly_name", "uri") VALUES (#{conference_sid}, #{date_created}, #{date_updated}, #{account_sid}, 
        #{status}, #{start_time}, #{end_time}, #{friendly_name}, #{uri});
    </insert>
	<select id="getConferenceDetailRecord" parameterType="string" resultType="hashmap">
		SELECT * FROM "restcomm_conference_detail_records WHERE "conference_sid"=#{conferenceSid};
	</select>
	<select id="getConferenceDetailRecords" parameterType="string" resultType="hashmap">
        SELECT * FROM "restcomm_conference_detail_records" WHERE "account_sid"=#{account_sid};
    </select>
    <select id="getConferenceDetailRecordsByStatus" parameterType="string" resultType="hashmap">
       SELECT * FROM "restcomm_conference_detail_records" WHERE "status"=#{status};
    </select> 
    <select id="getTotalConferenceDetailRecordByUsingFilters" parameterType="org.mobicents.servlet.restcomm.entities.ConferenceDetailRecordFilter" resultType="int">
		SELECT COUNT(*) FROM "restcomm_conference_detail_records" WHERE "account_sid"=#{accountSid}
		<if test="status != null">
			AND "status" like #{status}
		</if>
		<if test="friendlyName != null">
			AND "friendly_name" like #{friendlyName}
		</if>
		<if test="startTime != null">
		    AND "start_time" &gt;= #{startTime}
		</if>
		<if test="endTime != null">
			AND "end_time" &lt;= DATE_ADD(#{endTime},INTERVAL 1 DAY) order by "start_time"
		</if>

	</select>
	<select id="getConferenceDetailRecordByUsingFilters" parameterType="org.mobicents.servlet.restcomm.entities.ConferenceDetailRecordFilter" resultType="hashmap">
		SELECT * FROM "restcomm_conference_detail_records" AS "restcomm_conference_detail_records" WHERE "account_sid"=#{accountSid}
        <if test="status != null">
			AND "status" like #{status}
		</if>
		<if test="friendlyName != null">
			AND "friendly_name" like #{friendlyName}
		</if>
		<if test="startTime != null">
		    AND "start_time" &gt;= #{startTime}
		</if>
		<if test="endTime != null">
			AND "end_time" &lt;= DATE_ADD(#{endTime},INTERVAL 1 DAY) order by "start_time"
		</if>

		LIMIT #{limit} OFFSET #{offset}
	</select>
  
  <delete id="removeConferenceDetailRecord" parameterType="string">
    DELETE FROM "restcomm_conference_detail_records" WHERE "conference_sid"=#{conference_sid};
  </delete>
  
  <delete id="removeConferenceDetailRecords" parameterType="string">
    DELETE FROM "restcomm_conference_detail_records" WHERE "account_sid"=#{account_sid};
  </delete>
  
  <update id="updateConferenceDetailRecord" parameterType="map">
    UPDATE "restcomm_conference_detail_records" SET "date_updated"=#{date_updated}, "status"=#{status} WHERE "conference_sid"=#{conference_sid};
  </update>

</mapper>
