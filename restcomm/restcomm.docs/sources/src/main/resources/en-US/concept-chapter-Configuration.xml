<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "RestComm_User_Guide.ent">
%BOOK_ENTITIES;
]>
<!-- chapter id nickname: ittsss -->
<chapter>
<title>Getting Started and General Configuration</title>

<section>
<title>Quick Start Guide</title>
<para>
RestComm is a robust, powerful platform that will facilitate building comprehensive real-time communication solutions. The steps below will help you get started with ease.
</para>

<itemizedlist mark='opencircle'>
<title>Running RestComm on JBoss</title>
<listitem>
<para>
Download <filename> TelScale-Restcomm-JBoss-AS7-XX.XX.GA.zip </filename>
</para>
</listitem>
<listitem>
<para>
Using a terminal of your choice, extract the content of <filename> TelScale-Restcomm-XX.XX.GA.zip </filename> to a local directory on your computer. The root directoy into which you extract the content of the .zip file will be referred to as $RESTCOMM_HOME.
</para>
</listitem>
<listitem>
<para>
Go to <filename>$RESTCOMM_HOME/telscale-media/telscale-media-server/bin </filename>
</para>
</listitem>
<listitem>
<para>
change the permission of the <filename>run.sh</filename> as follows
</para>
</listitem>
<listitem>
<para>
sudo chmod +x ./run.sh
</para>
</listitem>
<listitem>
<para>
then start the TelScale Media Server as follows
</para>
</listitem>
<listitem>
<para>
sudo ./run.sh
</para>
</listitem>
<listitem>
<para>
If all is correctly started you will see the following at the end of the bash terminal window
<screen>
[MainDeployer] [[[[[[[[[ Mobicents Media Server: release.version=3.0.0.FINAL Started ]]]]]]]]]
</screen>
</para>
</listitem>

<listitem>
<para>
Open another terminal and proceed as follows:
</para>
</listitem>

<listitem>
<para>
Go to <filename>$RESTCOMM_HOME/bin </filename>
</para>
</listitem>
<listitem>
<para>
change the permissions of all the <filename>.sh</filename> files in the bin directory as follows
</para>
</listitem>
<listitem>
<para>
<filename>sudo chmod +x ./*.sh </filename>
</para>
</listitem>
<listitem>
<para>
Start RestComm by running the following command
</para>
</listitem>
<listitem>
<para>
<filename>sudo ./standalone.sh -c standalone-sip.xml</filename>
</para>
</listitem>

<listitem>
<para>
If RestComm is correctly started you will see the following at the end of the terminal
</para>

<screen>
INFO  [Version] TelScale Sip Servlets 6.1.3.GA-TelScale (build: Git Hash=r8947f2732ee64c76566ed6c0b236204c048538e1 date=201306131639) Started.
17:30:05,854 INFO  [Version] 
==============================================================================
==                                                                          ==
==                      Thank you for running TelScale                      ==
==    Carrier Grade Communications Platform by the creators of Mobicents    ==
==                    Copyright 2011-2013 Telestax, Inc.                    ==
==                         http://www.telestax.com/                         ==
==                                                                          ==
==============================================================================

</screen>
</listitem>

</itemizedlist>



<itemizedlist mark='opencircle'>
<title>Running RestComm on Tomcat</title>

<listitem>
<para>
Download <filename> TelScale-Restcomm-Tomcat-XX.XX.GA.zip </filename>
</para>
</listitem>
<listitem>
<para>
Using a terminal of your choice, extract the content of <filename> TelScale-Restcomm-Tomcat-XX.XX.GA.zip </filename> to a local directory on your computer. The root directoy into which you extract the content of the .zip file will be referred to as $RESTCOMM_HOME.
</para>
</listitem>
<listitem>
<para>
Go to <filename>$RESTCOMM_HOME/telscale-media/telscale-media-server/bin </filename>
</para>
</listitem>
<listitem>
<para>
change the permission of the <filename>run.sh</filename> as follows
</para>
</listitem>
<listitem>
<para>
sudo chmod +x ./run.sh
</para>
</listitem>
<listitem>
<para>
then start the TelScale Media Server as follows
</para>
</listitem>
<listitem>
<para>
sudo ./run.sh
</para>
</listitem>
<listitem>
<para>
If all is correctly started you will see the following at the end of the bash terminal window
<screen>
[MainDeployer] [[[[[[[[[ Mobicents Media Server: release.version=3.0.0.FINAL Started ]]]]]]]]]
</screen>
</para>
</listitem>

<listitem>
<para>
Open another terminal and proceed as follows:
</para>
</listitem>

<listitem>
<para>
Go to <filename>$RESTCOMM_HOME/bin </filename>
</para>
</listitem>
<listitem>
<para>
change the permissions of all the <filename>.sh</filename> files in the bin directory as follows
</para>
</listitem>
<listitem>
<para>
<filename>sudo chmod +x ./*.sh </filename>
</para>
</listitem>
<listitem>
<para>The content of the bin directory should be similar to the list below</para>
<screen>
bootstrap.jar                 digest.sh             tomcat-juli.jar
catalina.bat                  setclasspath.bat      tomcat-native.tar.gz
catalina.sh                   setclasspath.sh       tool-wrapper.bat
catalina-tasks.xml            shutdown.bat          tool-wrapper.sh
commons-daemon.jar            shutdown.sh           version.bat
commons-daemon-native.tar.gz  startup.bat           version.sh
cpappend.bat                  startup.sh
digest.bat                    telestax-license.xml

</screen>
<para>
Start RestComm by running the following command
</para>
</listitem>
<listitem>
<para>
<filename> sudo ./catalina.sh run</filename>
</para>
</listitem>
<listitem>
<para>If RestComm is correctly started on Tomcat, you will see an output similar to the one below </para>
<screen>
Started.
2013-08-15 19:02:46,903 INFO  [Version] (main) 
==============================================================================
==                                                                          ==
==                      Thank you for running TelScale                      ==
==    Carrier Grade Communications Platform by the creators of Mobicents    ==
==                    Copyright 2011-2013 Telestax, Inc.                    ==
==                         http://www.telestax.com/                         ==
==                                                                          ==
==============================================================================
Aug 15, 2013 7:02:50 PM org.apache.catalina.startup.Catalina start
INFO: Server startup in 14090 ms


</screen>
</listitem>

</itemizedlist>
</section>
<section>
<title>Testing the Demo Application</title>

<para>
Once you have the Media Server and RestComm started, you can now try out the demo application. Register the phone number 1234  and bind it to the hello-play.xml application by using the curl command below:
</para>

<programlisting>
<![CDATA[
curl -X POST  http://ACae6e420f425248d6a26948c17a9e2acf:77f8c12cc7b8f8423e5c38b035249166@127.0.0.1:8080/restcomm/2012-04-24/Accounts/ACae6e420f425248d6a26948c17a9e2acf/IncomingPhoneNumbers.json -d "PhoneNumber=1234" -d "VoiceUrl=http://127.0.0.1:8080/restcomm/demos/hello-play.xml"

]]>
</programlisting>
 
<para>
If the command succeeds, the output will be similar to the one below
</para>

<programlisting>
<![CDATA[
curl -X POST  http://ACae6e420f425248d6a26948c17a9e2acf:77f8c12cc7b8f8423e5c38b035249166@127.0.0.1:8080/restcomm/2012-04-24/Accounts/ACae6e420f425248d6a26948c17a9e2acf/IncomingPhoneNumbers.json -d "PhoneNumber=1234" -d "VoiceUrl=http://127.0.0.1:8080/restcomm/demos/hello-play.xml"

{
  "sid": "PN0834628c131e4b66bc862ae0b21b7cfa",
  "account_sid": "ACae6e420f425248d6a26948c17a9e2acf",
  "friendly_name": "1234",
  "phone_number": "+11234",
  "voice_url": "http://127.0.0.1:8080/restcomm/demos/hello-play.xml",
  "voice_method": "POST",
  "voice_fallback_method": "POST",
  "status_callback_method": "POST",
  "voice_caller_id_lookup": false,
  "date_created": "2013-08-15T17:45:21.409-06:00",
  "date_updated": "2013-08-15T17:45:21.409-06:00",
  "sms_method": "POST",
  "sms_fallback_method": "POST",
  "api_version": "2012-04-24",
  "uri": "/restcomm/2012-04-24/Accounts/ACae6e420f425248d6a26948c17a9e2acf/IncomingPhoneNumbers/PN0834628c131e4b66bc862ae0b21b7cfa.json"
]]>
</programlisting>
 
<warning>
 
You will need to use a SIP phone to call the number 1234 you have just registered. We recommend you use Ekiga as some SIP phones have codec incompatibility issues.
</warning>
<para>
At this stage, you can start Ekiga (see below) and dial <filename>1234@127.0.0.1:5080</filename>. You will hear a welcome message.
</para>

<mediaobject>
	<imageobject>
	<imagedata align="center" fileref="images/RestComm-ekiga-sip-phone-demo.png"/>
	</imageobject>
</mediaobject>
<para>
You are ready to start exploring RestComm and building powerful communication applications.
</para>

<para>
Do you want to see more samples of what you can do with TelScale RestComm, visit our site at <ulink url="http:www.telestax.com">TeleStax.com </ulink>
</para>


<note>
<title>Advanced Examples</title>
<para>Please go to this chapter for more examples <xref linkend="advanced-examples"/>.</para>
</note>
</section>



<section>

<title>Detailed Configuration</title>

	<para>In order for TelScale RestComm to function properly it must first be configured. In this chapter we will cover
	the settings for TelScale RestComm and it's respective plug-ins. In order to make TelScale RestComm easy to manage
	all of the configuration is done in only one file. The file is located at
	<filename>RESTCOMM_HOME/WEB-INF/conf/restcomm.xml</filename> and is composed of the sections that follow.</para>
	<note>
		<para>TelScale RestComm provides a default set of plug-ins for the storage engine, fax service, SMS aggregator,
		automatic speech recognition, and speech synthesis. All these services are pluggable and TelScale RestComm is not
		limited to any service provider or software platformz.</para>
	</note>	
	<section>
		<title>Runtime Settings</title>
		<para>
		  The runtime-settings are used by TelScale RestComm at runtime to customize it's behavior. A list of the runtime settings
		  and a description is provided below.
		</para>
			
		<table frame='all'>
			<title>Runtime Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>api-version</entry>
						<entry>The version of the TelScale RestComm API that we will be executing by default.</entry>
					</row>
					<row>
						<entry>prompts-uri</entry>
						<entry>The location where the audio prompts are located.</entry>
					</row>
					<row>
						<entry>cache-path</entry>
						<entry>The local path the cache folder.</entry>
					</row>
					<row>
						<entry>cache-uri</entry>
						<entry>The HTTP URI to the cache folder.</entry>
					</row>
					<row>
						<entry>recordings-path</entry>
						<entry>The local path to the folder containing the recordings.</entry>
					</row>
					<row>
						<entry>recordings-uri</entry>
						<entry>The HTTP URI to the folder containing the recordings.</entry>
					</row>
					<row>
						<entry>error-dictionary-uri</entry>
						<entry>The HTTP URI to the TelScale RestComm error dictionary.</entry>
					</row>
					<row>
						<entry>external-ip</entry>
						<entry>
							The IP to use for out-bound SIP REGISTER requests. This is useful when you
		  					want to report a different IP than the one TelScale RestComm picked by default.
		  				</entry>
					</row>
					<row>
						<entry>use-to</entry>
						<entry>
							If set to true TelScale RestComm will use the To header to determine the destination.
		  					If set to false TelScale RestComm will use the Request URI  to determine the destination.
						</entry>
					</row>
					<row>
						<entry>outbound-proxy-user</entry>
						<entry>
						  The user name used to authenticate with the outbound proxy. (Optional)
						</entry>
					</row>
					<row>
						<entry>outbound-proxy-password</entry>
						<entry>
						  The password used to authenticated with the outbound proxy. (Optional)
						</entry>
					</row>
					<row>
						<entry>outbound-proxy-uri</entry>
						<entry>
						  The SIP URI to the outbound proxy. Note: Do not prepend 'sip:' to the proxy uri.
						  If necessary the port can be included, for example alice@localhost:5080
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
		<formalpara>
			<title>TelScale Restcomm Resource Security</title>
			<para>The security model is based on role based access control. TelScale RestComm defines a set of permissions
			that can be defined for each role. There are two predefined roles Administrator and Developer. The Developer role
			can be configured or removed all together depending on your needs but the Administrator role can not be changed.
			The Administrator role can not be modified or removed and it has access to every resource.</para>
		</formalpara>
		<para>First we will define the list of permissions and what they mean.</para>
		<table frame='all'>
			<title>TelScale RestComm Permissions</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Permission</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>Create</entry>
						<entry>The role has access to create a type resource.</entry>
					</row>
					<row>
						<entry>Read</entry>
						<entry>The role has access to read a type of resource.</entry>
					</row>
					<row>
						<entry>Modify</entry>
						<entry>The role has access to modify a type of resource.</entry>
					</row>
					<row>
						<entry>Delete</entry>
						<entry>The role has access to delete a type of resource.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
		<para>These permissions apply to every resource exposed by the Restful APIs. Once a role is defined it can
		be specified for new Account resources that are created.</para>
		<note>
			<para>If no role is specified when creating a new Account resource then the new Account will inherit
			the security role of the account that created it. If this role is the Administrator role the system
			may become compromised.</para>
		</note>
		<formalpara>
			<title>Wildcard Permission</title>
			<para>The asterisk '*' is a wildcard that means grant all permissions and can be used in place of
			typing out all the permissions.</para>
		</formalpara>
		<para>To see how this all comes together please check out the <filename>restcomm.xml</filename> configuration
		file.</para>
	</section>
	<section>
		<title>VoIP Innovations Restful API Access</title>
		<para>The default auto provisioning API used by TelScale RestComm.</para>
		
		<table frame='all'>
			<title>VoIP Innovations Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>login</entry>
						<entry>The user name configured in the VoIP Innovations Portal under API users.</entry>
					</row>
					<row>
						<entry>password</entry>
						<entry>The password configured in the VoIP Innovations Portal under API users.</entry>
					</row>
					<row>
						<entry>endpoint</entry>
						<entry>The end point ID of the end point that will be used by TelScale RestComm</entry>
					</row>
					<row>
						<entry>uri</entry>
						<entry>The path to the VoIP Innovations service end point.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	<section>
		<title>Dao Manager</title>
		<para>The data access object manager is used to gain access to the data store that TelScale RestComm will use.</para>
			
		<para>The default data access object manager is based on MyBatis and provides access to RDBM systems.</para>
		
		<table frame='all'>
			<title>MyBatis Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>configuration-file</entry>
						<entry>The path to the mybatis.xml configuration file.</entry>
					</row>
					<row>
						<entry>data-files</entry>
						<entry>The path to the data files used to store the database tables.</entry>
					</row>
					<row>
						<entry>sql-files</entry>
						<entry>The path to the XML files containing the SQL statements that will be executed by the database.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	<section>
		<title>Media Server Manager</title>
		
		<para>
		  The media server manager is responsible for all the media servers managed by TelScale RestComm.
		</para>
		<table frame='all'>
			<title>Media Server Manager Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Property</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>local-address</entry>
						<entry>The local IP address for the MGCP stack.</entry>
					</row>
					<row>
						<entry>local-port</entry>
						<entry>The local port for the MGCP stack.</entry>
					</row>
					<row>
						<entry>remote-address</entry>
						<entry>The IP address for the media server.</entry>
					</row>
					<row>
						<entry>remote-port</entry>
						<entry>The port for the media server.</entry>
					</row>
					<row>
						<entry>response-timeout</entry>
						<entry>
							In milliseconds the maximum amount of time to wait for a response from
							the media server before abandoning the request. This does NOT apply to
							RQNT/NOTIFY request/response.
						</entry>
					</row>
					<row>
						<entry>external-address</entry>
						<entry>
							Sometimes there is interest to use a different address in the SDP than
							the IP address the media server is reporting. This parameter if set tells TelScale RestComm to
							patch the Connection attribute in the SDP on behalf of the media server to the specified IP address.
							Note: TelScale RestComm will only do NAT resolution when necessary so if your server already has a
							routable IP address setting this parameter will have no effect.
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	<section>
		<title>SMS Aggregator</title>
		<para>The SMS aggregator is responsible for the handling of SMS messages on behalf of TelScale RestComm.</para>
		
		<formalpara>
			<title>Requirements</title>
			<para>The default SMS aggregator is SMS over IP as used by VoIP Innovations. Therefore, an account must be
			created @ <ulink url="http://www.voipinnovations.com/">http://www.voipinnovations.com</ulink> before any text
			messages can be sent.</para>
		</formalpara>
		
		<para>Below is a list of settings that must be configured to send text messages.</para>
		
		<table frame='all'>
			<title>SMS Aggregator Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>outbound-prepend-string</entry>
						<entry>
							A string that you would like to prepend to the destination address. For example,
							to use service from VoIP Innovations a '#' must be prepended to every destination
							address.
						</entry>
					</row>
					<row>
						<entry>outbound-endpoint</entry>
						<entry>
							The SIP endpoint to which outbound SMS messages should be sent.
							Note: Do not prepend sip: to the endpoint. 
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	<section>
		<title>Fax Service</title>
		<para>The fax service sends faxes out on behalf of TelScale RestComm.</para>
		
		<formalpara>
			<title>Requirements</title>
			<para>The default fax service is provided by Interfax. Therefore, an account must be created @
			<ulink url="http://www.interfax.net/">http://www.interfax.net</ulink> before any faxes can be
			sent.</para>
		</formalpara>
		
		<table frame='all'>
			<title>Fax Service Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>user</entry>
						<entry>The user name used to authenticate with Interfax.</entry>
					</row>
					<row>
						<entry>password</entry>
						<entry>The password used to authenticate with Interfax.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	<section>
		<title>Speech Recognizer</title>
		<para>This speech recognizer turns speech into text on behalf of TelScale Restcomm.</para>
		
		<formalpara>
			<title>Requirements</title>
			<para>The default speech recognizer uses the ASR service provided by iSpeech. Therefore, an account must be created @
			<ulink url="http://www.ispeech.org/">http://www.ispeech.org</ulink> before any speech can be converted to text.</para>
		</formalpara>
		
		<table frame='all'>
			<title>Speech Recognizer Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>api-key</entry>
						<entry>The Web API key provided by iSpeech. This is used as an authentication token for the service.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>


	<section>
		<title>Speech Synthesizer</title>
		<para>The speech synthesizer turns text to speech on behalf of TelScale RestComm.</para>
		
		<formalpara>
			<title>Requirements</title>
			<para>The default speech synthesizer uses the TTS service provided by VoiceRSS. Therefore, an account must be created @
			<ulink url="http://http://www.voicerss.org/">http://www.voicerss.org</ulink> before any text can be converted to
			speech.</para>
		</formalpara>
		
		<table frame='all'>
			<title>VoiceRSS Speech Synthesizer Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>service-root</entry>
						<entry>The VoiceRSS service root URI.</entry>
					</row>
					 
					<row>
						<entry>apikey</entry>
						<entry>The API key used to authenticate with the VoiceRSS.</entry>
					</row>
					<row>
						<entry>languages</entry>
						<entry>
						  A list of male and female speakers for different languages. These can be replaced
						  with other alternatives provided by VoiceRSS.
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>


<!--
	<section>
		<title>Speech Synthesizer</title>
		<para>The speech synthesizer turns text to speech on behalf of TelScale RestComm.</para>
		
		<formalpara>
			<title>Requirements</title>
			<para>The default speech synthesizer uses the TTS service provided by Acapela. Therefore, an account must be created @
			<ulink url="http://www.acapela-vaas.com/">http://www.acapela-vaas.com</ulink> before any text can be converted to
			speech.</para>
		</formalpara>
		
		<table frame='all'>
			<title>Acapela Group Speech Synthesizer Settings</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
				<colspec colname='c1' />
				<colspec colname='c2' />
				<thead>
					<row>
						<entry align="center">Element</entry>
						<entry align="center">Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>service-root</entry>
						<entry>The acapela group service root URI.</entry>
					</row>
					<row>
						<entry>application</entry>
						<entry>The application used to authenticate with the acapela group.</entry>
					</row>
					<row>
						<entry>login</entry>
						<entry>The login used to authenticate with the acapela group.</entry>
					</row>
					<row>
						<entry>password</entry>
						<entry>The password used to authenticate with the acapela group.</entry>
					</row>
					<row>
						<entry>speakers</entry>
						<entry>
						  A list of male and female speakers for different languages. These can be replaced
						  with other alternatives provided by the acapela group.
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
-->
</section>
</chapter>
