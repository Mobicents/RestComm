<ul class="nav nav-pills">
    <li><a href="#/numbers/incoming">RESTCOMM NUMBERS</a></li>
    <li class="active"><a href="#/numbers/clients">SIP CLIENTS</a></li>
    <li><a href="#/numbers/outgoing">OUTGOING CALLER IDS</a></li>
    <!--<li><a href="#/numbers/shortcodes">SHORT CODES</a></li>-->
    <!--<li><a href="#/numbers/porting">PORTING REQUESTS</a></li>-->
</ul>

<div class="row-fluid">
    <div class="span12 well well-small"><h1 class="page-header"><i class="icon-phone"></i> NUMBERS</h1>  <h2 class="page-subheader"> _ SIP CLIENTS</h2></div>
</div>

<div class="row-fluid">
    <div class="span12">
        <div class="pull-left">
            <button class="btn btn-primary" ng-click="showRegisterSIPClient()"><i class="icon-plus"></i> Register SIP Client</button>
        </div>
        <div ng-show="clientsList.length > 0" class="pull-right">
            <h4><i class="icon-search"></i> Search <input type="text" class="search-query" ng-model="query.login"> </h4>
        </div>

        <div ng-hide="(clientsList | filter:query).length > 0" class="hero-unit no-records-alert">
            <h2><i class="icon-exclamation-sign"></i> No SIP clients <span ng-show="clientsList.length == 0">registered</span><span ng-show="clientsList.length > 0">matching query</span>. <small>Register one now!</small></h2>
        </div>

        <table ng-show="(clientsList | filter:query).length > 0" class="table table-striped table-hover" ng-cloak>
            <thead>
                <th class="width-20pc">SIP HANDLE</th>
                <th class="width-20pc" colspan="2">NAME</th>
                <th>FEATURES</th>
                <th class="width-10pc">&nbsp;</th>
            </thead>
            <tbody>
            <tr ng-repeat="sc in filtered = (clientsList | filter:query)">
                <td><h4 class="text-center"><a href="#/numbers/clients/{{sc.sid}}">{{ sc.login  }}</a></h4></td>
                <td><h5 class="text-center" ng-hide="editingFriendlyName == sc.login">{{ sc.friendly_name  }} </h5>
                    <h5 class="text-center" ng-show="editingFriendlyName == sc.login"><input type="text" class="input-small" onkeyup="if(event.keyCode == 13) {this.blur()}" ng-model="sc.friendly_name" ng-blur="editingFriendlyName = undefined; setFriendlyName(sc)" autofocus /></h5>
                </td>
                <td><h5><i class="icon-pencil clickable" ng-click="editingFriendlyName = sc.login"></i></h5></td>
                <td>
                    <span ng-show="{{ sc.voice_url.length > 0  }}"><i class="icon-microphone available-feature"></i> <small> {{ sc.voice_url  }}</small></span>
                    <span class="opacity30" ng-hide="{{ sc.voice_url.length > 0  }}"><i class="icon-microphone-off unavailable-feature"></i> <small> http://www.restcomm.org/demo/voice/</small></span>
                    <br>
                    <span ng-show="{{ sc.sms_url.length > 0  }}"><i class="icon-comment available-feature"></i> <small> {{ sc.sms_url  }}</small></span>
                    <span class="opacity30" ng-hide="{{ sc.sms_url.length > 0  }}"><i class="icon-comment-alt unavailable-feature"></i> <small> http://www.restcomm.org/demo/sms/</small></span>
                </td>
                <td class="text-right">
                    <div class="btn-delete-div"><button class="btn btn-danger" ng-click="confirmClientDelete(sc)">Delete</button></div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Register New Client Modal -->
<div modal="registeringNewClient" close="closeRegisterSIPClient()" options="modalOpts">
    <div class="modal-header">
        <h3><i class="icon-phone"></i> Register Client</h3>
    </div>
    <div class="modal-body">
        <dl class="dl-horizontal form-dl">
            <dt>Account SID</dt>
            <dd><input type="text" class="input-xlarge" id="new-client-account-sid" ng-model="sid" placeholder="Account SID" disabled /></dd>
            <!--<hr class="small" />-->
            <dt>Login</dt>
            <dd>
                <input id="new-client-login" ng-model="newClient.login" type="text" placeholder="eg: alice" required popover-placement="bottom" popover-trigger="focus" popover="The name that is used by the user agent as the user name for registration and outbound dialing." />
            </dd>
            <dt>Password</dt>
            <dd>
                <input id="new-client-password" ng-model="newClient.password" type="password" placeholder="Password" required />
            </dd>
            <!-- TODO: Implement password verification
            <dt>Confirm Password</dt>
            <dd>
                <input id="new-client-password-confirm" ng-model="newClient.password_confirm" type="password" placeholder="Password Confirmation" />
            </dd>
            -->
        </dl>
        <div class="text-right">
            <button ng-click="isCollapsed = !isCollapsed" class="btn btn-small"><i class="icon-ellipsis-horizontal"></i> Optional Parameters</legend></button>
        </div>
        <div collapse="isCollapsed">
            <hr />
            <dl class="dl-horizontal form-dl">
                <dt>Friendly Name</dt>
                <dd class="form-inline">
                    <input type="text" class="input-large" id="new-client-friendly-name" placeholder="Hot Line Client" ng-model="newClient.friendlyName" />
                </dd>
            </dl>
            <h4>Voice</h4>
            <dl class="dl-horizontal form-dl">
                <dt>Voice Request URL</dt>
                <dd class="form-inline">
                    <select class="input-small add-on" ng-init="newClient.voiceMethod='POST'" ng-model="newClient.voiceMethod">
                        <option>GET</option>
                        <option>POST</option>
                    </select>
                    <input type="text" id="new-client-voice-request-url" placeholder="http://restcomm-demo.appspot.com/app/voice/welcome.xml" ng-model="newClient.voiceURL" />
                    <i class="icon-list dropdown-toggle clickable" tooltip-placement="top" tooltip-trigger="focus" tooltip="Select from list..."
                       onclick="var elUL = $(this).next('ul'); $(this).next('ul').css({ top: ($(this).position().top-$(elUL).height()/2), left: ($(this).position().left-$(elUL).width()) });"></i>
                    <ul class="dropdown-menu">
                        <li ng-repeat="app in availableApps">
                            <a onclick="return false;" title="{{app.startUrl}}" ng-click="newClient.voiceURL = app.startUrl" href="#">{{app.name}}</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="/restcomm-rvd/" target="_blank"><i class="icon-sitemap"></i> Create New...</a></li>
                    </ul>
                </dd>
                <dt>Voice Fallback URL</dt>
                <dd class="form-inline">
                    <select class="input-small add-on" ng-init="newClient.voiceFallbackMethod='POST'" ng-model="newClient.voiceFallbackMethod">
                        <option>GET</option>
                        <option>POST</option>
                    </select>
                    <input type="text" id="new-client-voice-fallback-url" placeholder="http://restcomm-demo.appspot.com/app/voice/welcome.xml" ng-model="newClient.voiceFallbackURL" />
                    <i class="icon-list dropdown-toggle clickable" tooltip-placement="top" tooltip-trigger="focus" tooltip="Select from list..."
                       onclick="var elUL = $(this).next('ul'); $(this).next('ul').css({ top: ($(this).position().top-$(elUL).height()/2), left: ($(this).position().left-$(elUL).width()) });"></i>
                    <ul class="dropdown-menu">
                        <li ng-repeat="app in availableApps">
                            <a onclick="return false;" title="{{app.startUrl}}" ng-click="newClient.voiceFallbackURL = app.startUrl" href="#">{{app.name}}</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="/restcomm-rvd/" target="_blank"><i class="icon-sitemap"></i> Create New...</a></li>
                    </ul>
                </dd>
                <dt>Status Callback URL</dt>
                <dd class="form-inline">
                    <select class="input-small add-on" ng-init="newClient.statusCallbackMethod='POST'" ng-model="newClient.statusCallbackMethod">
                        <option>GET</option>
                        <option>POST</option>
                    </select>
                    <input type="text" id="new-client-status-callback-url" placeholder="http://restcomm-demo.appspot.com/app/voice/welcome.xml" ng-model="newClient.statusCallbackURL" />
                </dd>
            </dl>
            <h4>SMS Messaging</h4>
            <dl class="dl-horizontal form-dl">
                <dt>SMS Request URL</dt>
                <dd class="form-inline">
                    <select class="input-small add-on" ng-init="newClient.smsMethod='POST'" ng-model="newClient.smsMethod">
                        <option>GET</option>
                        <option>POST</option>
                    </select>
                    <input type="text" class="input-large" id="new-client-sms-request-url" placeholder="http://restcomm-demo.appspot.com/app/voice/welcome.xml" ng-model="newClient.smsURL" />
                </dd>
                <dt>SMS Fallback URL</dt>
                <dd class="form-inline">
                    <select class="input-small add-on" ng-init="newClient.smsFallbackMethod='POST'" ng-model="newClient.smsFallbackMethod">
                        <option>GET</option>
                        <option>POST</option>
                    </select>
                    <input type="text" class="input-large" id="new-client-sms-fallback-url" placeholder="http://restcomm-demo.appspot.com/app/voice/welcome.xml" ng-model="newClient.smsFallbackURL" />
                </dd>
            </dl>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn cancel" ng-click="closeRegisterSIPClient()">Cancel</button>
        <button class="btn btn-primary" ng-click="registerSIPClient(newClient)">Register</button>
    </div>
</div>
